# Service Management

Create and manage services for a Bedrock project.

Usage:

```
spk service [command] [options]
```

Commands:

- [Service Management](#service-management)
  - [Prerequisites](#prerequisites)
  - [Commands](#commands)
    - [create](#create)
    - [install-build-pipeline](#install-build-pipeline)
    - [create-revision](#create-revision)

Global options:

```
  -v, --verbose        Enable verbose logging
  -h, --help           Usage information
```

## Prerequisites

## Commands

### create

Add a new service into this initialized spk project repository

```
Usage: service create|c [options] <service-name>

Add a new service into this initialized spk project repository

Options:
  -c, --helm-chart-chart <helm-chart>                         bedrock helm chart name. --helm-chart-* and --helm-config-* are exclusive; you may only use one. (default: "")
  -r, --helm-chart-repository <helm-repository>               bedrock helm chart repository. --helm-chart-* and --helm-config-* are exclusive; you may only use one. (default: "")
  -b, --helm-config-branch <helm-branch>                      bedrock custom helm chart configuration branch. --helm-chart-* and --helm-config-* are exclusive; you may only use one. (default: "")
  -p, --helm-config-path <helm-path>                          bedrock custom helm chart configuration path. --helm-chart-* and --helm-config-* are exclusive; you may only use one. (default: "")
  -g, --helm-config-git <helm-git>                            bedrock helm chart configuration git repository. --helm-chart-* and --helm-config-* are exclusive; you may only use one. (default: "")
  -d, --packages-dir <dir>                                    The directory containing the mono-repo packages. (default: "")
  -n, --display-name <display-name>                           Display name of the service. (default: "")
  -m, --maintainer-name <maintainer-name>                     The name of the primary maintainer for this service. (default: "maintainer name")
  -e, --maintainer-email <maintainer-email>                   The email of the primary maintainer for this service. (default: "maintainer email")
  --git-push                                                  SPK CLI will try to commit and push these changes to a new origin/branch named after the service. (default: false)
  --variable-group-name <variable-group-name>                 The Azure DevOps Variable Group.
  --middlewares <comma-delimitated-list-of-middleware-names>  Traefik2 middlewares you wish to to be injected into your Traefik2 IngressRoutes (default: "")
  -h, --help                                                  output usage information
```

**NOTE:**

`--helm-chart-*` and `--helm-config-*` settings are exclusive. **You may only
use one.**

### install-build-pipeline

Install the build and push to acr pipeline for a service to your Azure DevOps
instance. The default pipeline generated by `spk service create` is a multistage
pipeline, which is in public preview and must be enabled to use.
https://docs.microsoft.com/en-us/azure/devops/pipelines/process/stages?view=azure-devops&tabs=yaml

```
Usage: service install-build-pipeline|p [options] <service-name>

Install the build and push to acr pipeline for a service to your Azure DevOps instance

Options:
  -n, --pipeline-name <pipeline-name>                  Name of the pipeline to be created
  -p, --personal-access-token <personal-access-token>  Personal Access Token
  -o, --org-name <org-name>                            Organization Name for Azure DevOps
  -r, --repo-name <repo-name>                          Repository Name in Azure DevOps
  -u, --repo-url <repo-url>                            Repository URL
  -d, --devops-project <devops-project>                Azure DevOps Project
  -b, --build-script <build-script-url>                Build Script URL. By default it is 'https://raw.githubusercontent.com/Microsoft/bedrock/master/gitops/azure-devops/build.sh'.
  -l, --packages-dir <packages-dir>                    The mono-repository directory containing this service definition. ie. '--packages-dir packages' if my-service is located under ./packages/my-service. Omitting this option implies this is a not a mono-repository.
  -h, --help                                           output usage information
```

### create-revision

Generate a PR in Azure DevOps against default ring branches

```
Usage: service create-revision|cr [options]

Create pull requests against the branches marked as `isDefault` in your bedrock config

Options:
  -s, --source-branch <source>     Source branch to create the pull request from; defaults to the current branch
  -t, --title <title>              Title of the pull request; not required
  -d, --description <description>  Description of the pull request; not required
  --remote-url <remote-url>        The remote host to create the pull request in; defaults to the URL for 'origin'
  --personal-access-token <pat>    Personal access token associated with your Azure DevOps token; falls back to azure_devops.access_token in your spk config
  --org-name <organization-name>   Your Azure DevOps organization name; falls back to azure_devops.org in your spk config
  --target-branch                  Target branch/ring to create a PR against; overwrites the default rings specified in bedrock.yaml
  -h, --help                       output usage information
```
